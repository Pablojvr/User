<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Authors</title>
        <!-- Este estilo corresponde a boostrap. Puede copiar y pegar del sitio oficial de
       bootstrap-->
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-
              BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous" />

        <style>
            .table {
                border-radius: 5px;
                width: 50%;
                margin: 0px auto;
                float: none;
            }
        </style>
    </h:head>
    <h:body>
        <div class="container-fluid">


            <h:form id="authorForm">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Authors Form
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>

                                <label for="authorForm:authorName">Author Name</label>
                                <h:inputText id="authorName"
                                             value="#{authorBean.author.authorName}" required="true"
                                             requiredMessage="Ingrese nombre del autor" styleClass="formcontrol">
                                    <f:ajax event="blur"

                                            listener="#{authorBean.countAuthor(authorBean.author.authorName)}"
                                            render="@form" />
                                </h:inputText>


                            </td>

                        </tr>
                        <tr>

                            <td>
                                <label for="authorForm:authorBirth">Birth</label>
                                <h:inputText id="authorBirth" value="#{authorBean.author.authorBirth}"
                                             required="true" requiredMessage="Ingrese fecha de nacimiento"
                                             styleClass="form-control"
                                             >
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:inputText>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="authorForm:authorNumber">Number </label>
                                <h:inputText id="authorNumber"
                                             value="#{authorBean.author.authorNumber}"
                                             required="true" requiredMessage="Ingrese un número de teléfono
                                             válido"
                                             styleClass="form-control"
                                             >
                                    <f:validator validatorId="sv.edu.udb.util.SVPhoneValidator" />
                                </h:inputText>
                            </td>
                        </tr>
                        <tr>

                            <td>

                                <label for="authorForm:genre">Genre</label>
                                <h:selectOneMenu id="genre"
                                                 value="#{authorBean.author.literaryGenre}" styleClass="form-control">
                                    <f:selectItems value="#{authorBean.literaryGenreModel.literaryGenre}"
                                                   var="l" itemLabel="#{l.name}" itemValue="#{l.id}"

                                                   />
                                </h:selectOneMenu>
                            </td>
                        </tr>
                        <tr>
                            <td>



                                <h:commandButton value="Agregar" action="#{authorBean.addAuthor()}"
                                                 styleClass="btn btn-primary center-block"
                                                 >
                                    <f:ajax execute="@form"
                                            render="authorsTable authorForm datatableauthors"
                                            resetValues="true"/>

                                </h:commandButton>
                                <br></br>
                                <center>

                                    <h:outputLink value="filtro.xhtml" styleClass="btn btn-success" >
                                        Listar
                                    </h:outputLink>
                                </center>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>
                                <h:messages id="successMessage" infoStyle="color:darkgreen"
                                            errorStyle="color:darkred" />
                                <h:messages id="errorMessage" infoStyle="color:darkgreen"
                                            globalOnly="true" errorStyle="color:darkred" />

                            </td>
                        </tr>
                    </tfoot>
                </table>
            </h:form>

        </div>
        <h:form id="datatableauthors">
            <h:dataTable id="authorsTable" value="#{authorBean.authorModel.authors}"
                         var="c"
                         styleClass="table table-striped"
                         >
                <h:column>
                    <f:facet name="header">
                        Author ID
                    </f:facet>
                    #{c.authorId}
                </h:column>
                <h:column>
                    <f:facet name="header">
                        Author Name
                    </f:facet>
                    #{c.authorName}
                </h:column>

                <h:column>
                    <f:facet name="header">
                        Phone Number
                    </f:facet>
                    #{c.authorNumber}
                </h:column>


                <h:column>
                    <f:facet name="header">
                        Date Birth
                    </f:facet>
                    <h:outputText value="#{c.authorBirth}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        Literary Genre
                    </f:facet>
                    #{c.literaryGenre}
                </h:column>
                <h:column>
                    <f:facet name="header">
                        Operations
                    </f:facet>

                    <h:commandButton action="#{authorBean.deleteAuthor(c)}"
                                     onclick="if (!confirm('Do you want to delete this author?'))
                                                 return false"
                                     value="Delete">
                        <f:ajax execute="@form" render="@form" />
                    </h:commandButton>
                </h:column>
            </h:dataTable>
        </h:form>
    </h:body>
</html>